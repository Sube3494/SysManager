# 🔧 WebUI配置问题修复

## ❌ 问题描述
通过WebUI配置后，插件无法获取到配置的群组列表。

## ✅ 问题原因
配置结构需要有 `sysmanager` 这一层，配置项在其下面。

## 📋 修复步骤

### 1. 立即测试（查看当前配置）

在群里或私聊发送：
```
/sys info
```

查看返回的 "原始配置" 部分，应该是这样的结构：
```
原始配置: {'sysmanager': {'enabled_groups': [123456789], ...}}
```

如果显示为空 `{}` 或没有 `sysmanager` 层，说明配置未正确加载。

### 2. 重新配置（通过WebUI）

1. 打开 AstrBot Web管理面板
2. 进入 **插件管理** → **SysManager** → **配置**
3. 在 `enabled_groups` 字段中输入群号，格式：
   - 单个群：`[123456789]`
   - 多个群：`[123456789, 987654321]`
   - 注意：必须是 JSON 数组格式，带方括号
4. **保存配置**
5. **重启插件**（重要！）

### 3. 手动修复（直接编辑文件）

如果WebUI配置仍有问题，手动编辑配置文件：

找到文件：`data/config/SysManager_config.json`

确保内容格式正确：
```json
{
  "sysmanager": {
    "enabled_groups": [123456789, 987654321],
    "command_timeout": 30,
    "max_output_length": 2000,
    "log_operations": true
  }
}
```

**注意要点：**
- 必须有 `"sysmanager"` 作为顶层 key
- 群号是数字，不要加引号
- JSON 格式要正确（逗号、括号）

### 4. 验证配置

重启插件后，查看控制台日志：
```
✅ 服务器管理插件已加载
   原始配置: {'sysmanager': {'enabled_groups': [123456789], ...}}
   生效范围: 1个指定群
   群组列表: [123456789]
```

然后在群里测试：
```
/sys info
```

应该看到：
```
📋 配置信息:
生效的群组: [123456789]

🔐 权限状态:
当前群号: 123456789
权限检查: ✅ 通过
状态: 群 123456789 在白名单中
```

## 🎯 快速检查清单

- [ ] 配置文件存在 `sysmanager` 层
- [ ] 群号是数字格式，无引号
- [ ] WebUI保存后已重启插件
- [ ] `/sys info` 显示正确的配置
- [ ] 控制台日志显示群组列表

## 💡 调试技巧

1. **查看完整配置：**
   ```
   /sys info
   ```
   会显示 "原始配置"，可以看到实际加载的配置内容

2. **查看控制台日志：**
   插件启动时会打印配置信息

3. **测试不同格式：**
   如果群号很长，确保没有被截断或转换

## 🚨 常见错误

1. **WebUI输入格式错误：**
   - ❌ 错误：`123456789`（缺少方括号）
   - ❌ 错误：`"123456789"`（不应该是字符串）
   - ✅ 正确：`[123456789]`

2. **配置未生效：**
   - 必须重启插件
   - 可能需要重启整个AstrBot

3. **群号获取失败：**
   - 使用 `/sys info` 查看实际群号
   - 不同QQ框架格式可能不同

---

**提示：** 使用 `/sys info` 是调试配置问题的最佳工具！它会显示完整的配置和权限状态。
